#!/bin/bash
#PBS -l nodes=1:ppn=1
#PBS -l walltime=00:30:00
#PBS -l mem=4gb
#PBS -j oe
#PBS -o /dev/null
#PBS -N run_@@RUN@@
#PBS -W umask=000

# All generated files will be user and group read- and writeable, and
# executable if appropriate. "Other" users have no permissions.
#umask 007

cd $PBS_O_WORKDIR

OUTFILE=@@OUTDIR@@/run_@@RUN@@.txt
LOGFILE=@@LOGDIR@@/run_@@RUN@@.log

# Create empty files (or overwrite existing file(s))
printf '' > $OUTFILE
printf '' > $LOGFILE

# Immediately set ownership / permissions on files before doing anything else
chgrp dfc13_collab $OUTFILE $LOGFILE
chmod g+rw $OUTFILE $LOGFILE

# Write some useful info to the outfile
echo "Hello from hostname `hostname`" >> $OUTFILE

echo "" >> $OUTFILE

echo "lscpu" >> $OUTFILE
echo "-------" >> $OUTFILE
lscpu >> $OUTFILE

echo "" >> $OUTFILE

echo "PBS env vars" >> $OUTFILE
echo "------------" >> $OUTFILE
env | grep -E "^PBS" >> $OUTFILE

echo "" >> $OUTFILE

sleep 100
echo "I slept 100 seconds" >> $LOGFILE
